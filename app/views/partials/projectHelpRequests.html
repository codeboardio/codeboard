<div ng-include="'partials/navbar.html'"></div>

<div class="container" style="margin-top: 40px">
  <div class="row">
    <div class="col-md-12">
      <h3>Help Requests for <a ng-href="/projects/{{projectId}}/summary">project {{projectId}}</a></h3>
    </div>
  </div>

  <div class="row" ng-show="helpRequestData.length > 0">
    <div class="col-md-4 pull-right">
      <input type="text" placeholder="Filter by username" ng-model="usernameFilter" uib-typeahead="elem.username as elem.username for elem in helpRequestData | filter:{username:$viewValue} | limitTo:8" class="form-control">
    </div>
  </div>

  <div class="row" ng-show="helpRequestData.length == 0 || filteredData == 0" style="padding-top: 40px;">
    <div class="col-md-10 col-md-offset-1">
      <div class="jumbotron">
        <h3>No help requests found.</h3>
        <p ng-show="usernameFilter == undefined || usernameFilter.length == 0">It looks like this project has no help requests.</p>
        <p ng-show="usernameFilter !== undefined && usernameFilter.length > 0">It looks like user '{{usernameFilter}}' has no help requests.</p>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <ul style="list-style-type: none;">
        <li ng-repeat="elem in filteredData = (helpRequestData | filter:{username: usernameFilter} | orderBy: 'username')" style="padding: 15px;">
          <h4>
            <a ng-href="/users/{{elem.username}}" ng-if="elem.username !== '#anonymous'">{{elem.username}}</a>
            <span ng-if="elem.username === '#anonymous'">{{elem.username}}</span>
            ({{elem.helpRequests.length}})
          </h4>
          <table class="table table-condensed table-hover">
            <tr>
              <th title="Date when the request was created">Created</th>
              <th title="Project">Project</th>
              <th title="Status of the help request">Status</th>
              <th title="Result forwarded via LTI to other platform">LTI</th>
              <th></th>
            </tr>
            <tr ng-repeat="request in elem.helpRequests | orderBy:'createdAt':true">
              <td>{{request.createdAt | date: 'medium'}}</td>
              <td>{{request.projectName}}</td>
              <td>{{request.status}}</td>
              <td>{{request.isLtiSubmission ? 'yes' : 'no'}}</td>
              <td><a class="btn btn-default btn-xs"  ng-href="/projects/{{projectId}}/version/help/{{request.helpRequestId}}">Open in IDE</a></td>
            </tr>
          </table>
        </li>
      </ul>
    </div>
  </div>

</div> <!-- end of container -->
