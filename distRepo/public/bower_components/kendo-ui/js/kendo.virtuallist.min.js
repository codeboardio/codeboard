/**
 * Copyright 2015 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e,define){define(["./kendo.data.min"],e)}(function(){return function(e,t){function n(e){return e[e.length-1]}function i(e){return e instanceof Array?e:[e]}function r(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e}function o(e,t,n){return Math.ceil(e*t/n)}function a(e,t,n){var i=document.createElement(n||"div");return t&&(i.className=t),e.appendChild(i),i}function s(){var t,n=e('<div class="k-popup"><ul class="k-list"><li class="k-item"><li></ul></div>');return n.css({position:"absolute",left:"-200000px",visibility:"hidden"}),n.appendTo(document.body),t=parseFloat(m.getComputedStyles(n.find(".k-item")[0],["line-height"])["line-height"]),n.remove(),t}function l(e,t,n){return{down:e*n,up:e*(t-1-n)}}function c(e,t){var n=(e.listScreens-1-e.threshold)*t,i=e.threshold*t;return function(e,t,r){return t>r?n>t-e.top:0===e.top||t-e.top>i}}function d(e,t){return function(n){return t(e.scrollTop,n)}}function u(e){return function(t,n){return e(t.items,t.index,n),t}}function h(e,t){m.support.browser.msie&&10>m.support.browser.version?e.style.top=t+"px":(e.style.webkitTransform="translateY("+t+"px)",e.style.transform="translateY("+t+"px)")}function p(t,n){return function(i,r){for(var o=0,a=i.length;a>o;o++)t(i[o],r[o],n),r[o].item&&(this.trigger(L,{item:e(i[o]),data:r[o].item,ns:m.ui}),r[o].index===this._selectedIndex&&this.select(this._selectedIndex))}}function f(e,t){var n;return t>0?(n=e.splice(0,t),e.push.apply(e,n)):(n=e.splice(t,-t),e.unshift.apply(e,n)),n}function g(n,i,r){var o=r.template;n=e(n),i.item||(o=r.placeholderTemplate),this.angular("cleanup",function(){return{elements:[n]}}),n.attr("data-uid",i.item?i.item.uid:"").attr("data-offset-index",i.index).find("."+D).html(o(i.item||{})),n.toggleClass(I,i.current),n.toggleClass(P,i.selected),n.toggleClass("k-first",i.newGroup),i.newGroup&&e("<div class="+E+"></div>").appendTo(n.find("."+D)).html(r.groupTemplate({group:i.group})),i.top!==t&&h(n[0],i.top),this.angular("compile",function(){return{elements:[n],data:[{dataItem:i.item,group:i.group,newGroup:i.newGroup}]}})}var m=window.kendo,v=m.ui,_=v.Widget,y=v.DataBoundWidget,w=e.proxy,b="k-virtual-wrap",x="k-virtual-list",k="k-virtual-content",C="k-list",S="k-virtual-header",T="k-virtual-item",D="k-item",A="k-virtual-option-label",M="k-height-container",E="k-group",P="k-state-selected",I="k-state-focused",z="change",F="click",B="listBound",L="itemChange",R="activate",O="deactivate",H=".VirtualList",N=y.extend({init:function(e,t){var n=this;n._listCreated=!1,n._fetching=!1,n._filter=!1,_.fn.init.call(n,e,t),e=n.element,e.addClass(x),n.options.itemHeight||(n.options.itemHeight=s()),t=n.options,n.wrapper=e.wrap("<div class='"+b+"' role='listbox'></div>").parent(),n.header=n.element.before("<div class='"+S+"'></div>").prev(),n.content=e.append("<ul class='"+k+" "+C+"'></ul>").find("."+k),n._values=i(n.options.value),n._selectedDataItems=[],n._selectedIndexes=[],n._rangesList={},n._activeDeferred=null,n._promisesList=[],n._optionID=m.guid(),n.setDataSource(t.dataSource),e.on("scroll"+H,function(){n._renderItems()}),n._selectable()},options:{name:"VirtualList",autoBind:!0,height:null,listScreens:4,threshold:.5,itemHeight:null,oppositeBuffer:1,type:"flat",selectable:!1,value:[],dataValueField:null,template:"#:data#",placeholderTemplate:"loading...",groupTemplate:"#:group#",fixedGroupTemplate:"fixed header template",optionLabel:null,valueMapper:null},events:[z,F,B,L,R,O],setOptions:function(e){_.fn.setOptions.call(this,e),this._selectProxy&&this.options.selectable===!1?this.wrapper.off(F,"."+T+", ."+A,this._selectProxy):!this._selectProxy&&this.options.selectable&&this._selectable(),this.refresh()},items:function(){return e(this._items)},destroy:function(){this.wrapper.off(H),this.element.off(H),this.dataSource.unbind(z,this._refreshHandler),_.fn.destroy.call(this)},setDataSource:function(t){var n=this,i=t||{};i=e.isArray(i)?{data:i}:i,n.dataSource=m.data.DataSource.create(i),n._refreshHandler=e.proxy(n.refresh,n),n.dataSource.bind(z,n._refreshHandler),0!==n.dataSource.view().length?n.refresh():n.options.autoBind&&n.dataSource.fetch()},refresh:function(){var e=this;e._mute||(e._fetching?e._renderItems&&e._renderItems(!0):(e._createList(),e._values.length&&!e._filter&&e._prefetchByValue(e._values),e._listCreated=!0,e.trigger(B)),e._fetching=!1)},value:function(n,r){{var o=this;e.Deferred()}return n===t?o._values:r?(o._values=n=i(n),t):((""===n||null===n)&&(n=[]),n instanceof Array&&!n.length?(o.select(-1),t):(o._selectedDataItems=[],o._selectedIndexes=[],o._values=n=i(n),o.isBound()&&o._prefetchByValue(n),t))},_prefetchByValue:function(e){var n,o,a,s=this,l=s._dataView,c=s._valueGetter,d=!1,u=[];for(o=0;e.length>o;o++)for(a=0;l.length>a;a++)n=l[a].item,n&&(d=r(n)?e[o]===n:e[o]===c(n),d&&u.push(a));if(u.length===e.length)return s._values=[],s.select(u),t;if("function"!=typeof s.options.valueMapper)throw Error("valueMapper is not provided");s.options.valueMapper({value:"multiple"===this.options.selectable?e:e[0],success:function(e){s._values=[],s.select(i(e))}})},deferredRange:function(t){var n=this.dataSource,i=this.itemCount,r=this._rangesList,o=e.Deferred(),a=[],s=Math.floor(t/i)*i,l=Math.ceil(t/i)*i,c=l===s?[l]:[s,l];return e.each(c,function(t,o){var s,l=o+i,c=r[o];c&&c.end===l?s=c.deferred:(s=e.Deferred(),r[o]={end:l,deferred:s},n._multiplePrefetch(o,i,function(){s.resolve()})),a.push(s)}),e.when.apply(e,a).then(function(){o.resolve()}),o},prefetch:function(t){var n=this,i=this.itemCount,r=!n._promisesList.length;return n._activeDeferred||(n._activeDeferred=e.Deferred(),n._promisesList=[]),e.each(t,function(e,t){var r=Math.floor(t/i)*i;n._promisesList.push(n.deferredRange(r))}),r&&e.when.apply(e,n._promisesList).done(function(){n._activeDeferred.resolve(),n._activeDeferred=null,n._promisesList=[]}),this._activeDeferred},_findDataItem:function(e){var t,n,i=this.dataSource.view();if("group"===this.options.type)for(n=0;i.length>n;n++){if(t=i[n].items,!(e>t.length))return t[e];e-=t.length}return i[e]},selectedDataItems:function(){return this._selectedDataItems},scrollTo:function(e){this.element.scrollTop(e)},scrollToIndex:function(e){this.scrollTo(e*this.options.itemHeight)},focus:function(i){var r,o,a,s,l,c,d=this.options.itemHeight,u=this._optionID;if(i===t)return s=this.content.find("."+I),s.length?s:null;if("function"==typeof i)for(a=this.data(),l=0;a.length>l;l++)if(i(a[l])){i=l;break}if(i instanceof Array&&(i=n(i)),isNaN(i)?(r=e(i),o=parseInt(e(r).attr("data-offset-index"),10)):(o=i,r=this._getElementByIndex(o)),-1===o)return this.content.find("."+I).removeClass(I),this._focusedIndex=t,t;if(r.length){if(r.hasClass(I))return;this._focusedIndex!==t&&(s=this._getElementByIndex(this._focusedIndex),s.removeClass(I).removeAttr("id"),this.trigger(O)),this._focusedIndex=o,r.addClass(I).attr("id",u),c=this._getElementLocation(o),"top"===c?this.scrollTo(o*d):"bottom"===c&&this.scrollTo(o*d+d-this.screenHeight),this.trigger(R)}else this._focusedIndex=o,this.items().add(this.optionLabel).removeClass(I),this.scrollToIndex(o)},first:function(){this.scrollTo(0),this.focus(0)},last:function(){var e=this.dataSource.total();this.scrollTo(this.heightContainer.offsetHeight),this.focus(e)},prev:function(){var e=this._focusedIndex;return!isNaN(e)&&e>0?(this.focus(e-1),e-1):t},next:function(){var e=this._focusedIndex,n=this.dataSource.total()-1;return!isNaN(e)&&n>e?(this.focus(e+1),e+1):t},select:function(e){var i,r,o,a=this,s="multiple"!==this.options.selectable,l=!!this._activeDeferred,c=[],d=[];return e===t?this._selectedIndexes.slice():(i=this._getIndecies(e),!i.length||s&&n(i)===n(this._selectedIndexes)||(d=this._deselect(i),i.length?(s&&(this._activeDeferred=null,l=!1,i=[n(i)]),o=function(){c=a._select(i),a.focus(i),(c.length||d.length)&&a.trigger(z,{added:c,removed:d})},r=this.prefetch(i),l||(r?r.done(o):o())):this.trigger(z,{added:c,removed:d})),t)},data:function(){var e=this.dataSource.view(),t=this.optionInstance,n=e.length,i=0;if(t&&n){for(t=new m.data.ObservableArray([t]);n>i;i++)t.push(e[i]);e=t}return e},isBound:function(){return this._listCreated},mute:function(e){this._mute=!0,w(e(),this),this._mute=!1},filter:function(e){return e===t?this._filter:(this._filter=e,t)},clearIndices:function(){this._selectedIndexes=[]},_getElementByIndex:function(t){var n;return n=-1===t?this.optionLabel:this.items().filter(function(n,i){return t===parseInt(e(i).attr("data-offset-index"),10)})},_clean:function(){this.result=t,this._lastScrollTop=t,this.optionLabel&&(this.optionLabel.parent().remove(),this.optionLabel=t),this.content.empty()},_screenHeight:function(){var e=this.options.height,t=this.element;e?t.height(e):e=t.height(),this.screenHeight=e},_getElementLocation:function(e){var t,n=this.element.scrollTop(),i=this.screenHeight,r=this.options.itemHeight,o=e*r,a=o+r,s=n+i;return t=o===n-r||a>n&&n>o?"top":o===s||s>o&&a>s?"bottom":o>=n&&n+(i-r)>=o?"inScreen":"outScreen"},_templates:function(){var e,t={template:this.options.template,placeholderTemplate:this.options.placeholderTemplate,groupTemplate:this.options.groupTemplate,fixedGroupTemplate:this.options.fixedGroupTemplate};for(e in t)"function"!=typeof t[e]&&(t[e]=m.template(t[e]));this.templates=t},_generateItems:function(e,t){for(var n,i=[];t-->0;)n=document.createElement("li"),n.tabIndex=-1,n.className=T,n.setAttribute("role","option"),n.innerHTML="<div class='"+D+"'></div>",e.appendChild(n),i.push(n);return i},_saveInitialRanges:function(){var t,n=this.dataSource._ranges,i=e.Deferred();for(i.resolve(),this._rangesList={},t=0;n.length>t;t++)this._rangesList[n[t].start]={end:n[t].end,deferred:i}},_createList:function(){{var t=this,n=t.element.get(0),i=t.options,r=t.dataSource;r.total()}t._listCreated&&t._clean(),t._saveInitialRanges(),t._screenHeight(),t._buildValueGetter(),t.itemCount=o(t.screenHeight,i.listScreens,i.itemHeight),t.itemCount>r.total()&&(t.itemCount=r.total()),t._templates(),t._optionLabel(),t._items=t._generateItems(t.content[0],t.itemCount),t._setHeight(i.itemHeight*r.total()),t.options.type=r.group().length?"group":"flat",t.getter=t._getter(function(){t._renderItems(!0)}),t._onScroll=function(e,n){var i=t._listItems(t.getter);return t._fixedHeader(e,i(e,n))},(t._renderItems=t._whenChanged(d(n,t._onScroll),u(t._reorderList(t._items,e.proxy(g,t)))))()},_setHeight:function(e){var t,n,i=this.heightContainer;if(i?t=i.offsetHeight:i=this.heightContainer=a(this.element[0],M),e!==t)for(i.innerHTML="";e>0;)n=Math.min(e,25e4),a(i).style.height=n+"px",e-=n},_getter:function(){var e=null,t=this.dataSource,n=t.skip(),i=this.options.type,r=this.itemCount,o={};return function(a,s){var l,c,d,u,h,p,f,g,m=this;if(t.inRange(s,r)){if(n!==s&&(this._mute=!0,this._fetching=!0,t.range(s,r),n=s,this._mute=!1),"group"===i){if(!o[s])for(c=o[s]=[],d=t.view(),u=0,h=d.length;h>u;u++)for(p=d[u],f=0,g=p.items.length;g>f;f++)c.push({item:p.items[f],group:p.value});l=o[s][a-s]}else l=t.view()[a-s];return l}return e!==s&&(e=s,n=s,this._fetching=!0,this.deferredRange(s).then(function(){m._fetching=!0,t.range(s,r)})),null}},_fixedHeader:function(e,t){var n,i=this.currentVisibleGroup,r=this.options.itemHeight,o=Math.floor((e-t.top)/r),s=t.items[o];return s&&s.item&&(n=s.group,n!==i&&(this.header[0].innerHTML="",a(this.header[0],E).innerHTML=n,this.currentVisibleGroup=n)),t},_itemMapper:function(e,t){var n,i=this.options.type,o=this.options.itemHeight,a=this._values,s=this._focusedIndex,l=!1,c=!1,d=!1,u=null,h=!1,p=this._valueGetter;if("group"===i&&(e&&(d=0===t||this._currentGroup&&this._currentGroup!==e.group,this._currentGroup=e.group),u=e?e.group:null,e=e?e.item:null),a.length&&e)for(n=0;a.length>n;n++)if(h=r(e)?a[n]===e:a[n]===p(e)){l=!0;break}return s===t&&(c=!0),{item:e?e:null,group:u,newGroup:d,selected:l,current:c,index:t,top:t*o}},_range:function(e){var t,n,i,r=this.itemCount,o=[];for(this._view={},this._currentGroup=null,n=e,i=e+r;i>n;n++)t=this._itemMapper(this.getter(n,e),n),o.push(t),this._view[t.index]=t;return this._dataView=o,o},_getDataItemsCollection:function(e,t){var n=this._range(this._listIndex(e,t));return{index:n.length?n[0].index:0,top:n.length?n[0].top:0,items:n}},_listItems:function(){var t=this.screenHeight,n=this.options,i=c(n,t);return e.proxy(function(e,t){var n=this.result,r=this._lastScrollTop;return!t&&n&&i(n,e,r)||(n=this._getDataItemsCollection(e,r)),this._lastScrollTop=e,this.result=n,n},this)},_whenChanged:function(e,t){var n;return function(i){var r=e(i);r!==n&&(n=r,t(r,i))}},_reorderList:function(t,n){var i=this,r=t.length,o=-1/0;return n=e.proxy(p(n,this.templates),this),function(e,a,s){var l,c,d=a-o;s||Math.abs(d)>=r?(l=t,c=e):(l=f(t,d),c=d>0?e.slice(-d):e.slice(0,-d)),n(l,c,i._listCreated),o=a}},_bufferSizes:function(){var e=this.options;return l(this.screenHeight,e.listScreens,e.oppositeBuffer)},_indexConstraint:function(e){var t=this.itemCount,n=this.options.itemHeight,i=this.dataSource.total();return Math.min(i-t,Math.max(0,Math.floor(e/n)))},_listIndex:function(e,t){var n,i=this._bufferSizes();return n=e-(e>t?i.down:i.up),this._indexConstraint(n)},_selectable:function(){this.options.selectable&&(this._selectProxy=e.proxy(this,"_clickHandler"),this.wrapper.on(F+H,"."+T+", ."+A,this._selectProxy))},_getIndecies:function(e){var t,n,i=[];if("function"==typeof e)for(t=this.data(),n=0;t.length>n;n++)if(e(t[n])){i.push(n);break}return"number"==typeof e&&i.push(e),e instanceof jQuery&&(e=parseInt(e.attr("data-offset-index"),10),isNaN(e)||i.push(e)),e instanceof Array&&(i=e),i},_deselect:function(n){var i,r,o,a,s,l=[],c=this._selectedIndexes,d=0,u=this.options.selectable,h=0;if(-1===n[d]){for(a=0;c.length>a;a++)r=c[a],l.push({index:r,position:a,dataItem:this._selectedDataItems[a]});return this._values=[],this._selectedDataItems=[],this._selectedIndexes=[],n.splice(0,n.length),l}if(u===!0)i=n[d],r=c[d],r!==t&&i!==r&&(this._getElementByIndex(r).removeClass(P),l.push({index:r,position:d,dataItem:this._selectedDataItems[d]}),this._values=[],this._selectedDataItems=[],this._selectedIndexes=[]);else if("multiple"===u)for(s=0;n.length>s;s++)d=e.inArray(n[s],c),r=c[d],r!==t&&(this._getElementByIndex(r).removeClass(P),this._values.splice(d,1),this._selectedIndexes.splice(d,1),o=this._selectedDataItems.splice(d,1),n.splice(s,1),l.push({index:r,position:d+h,dataItem:o}),h++,s--);return l},_select:function(t){var n,i,o=this,a="multiple"!==this.options.selectable,s=this.dataSource,l=this.itemCount,c=this._valueGetter,d=[];return a&&(o._selectedIndexes=[],o._selectedDataItems=[],o._values=[]),i=s.skip(),e.each(t,function(e,t){var a=l>t?1:Math.floor(t/l)+1,u=(a-1)*l;o.mute(function(){s.range(u,l),n=o._findDataItem([t-u]),o._selectedIndexes.push(t),o._selectedDataItems.push(n),o._values.push(r(n)?n:c(n)),d.push({index:t,dataItem:n}),o._getElementByIndex(t).addClass(P),s.range(i,l)})}),d},_clickHandler:function(t){t.isDefaultPrevented()||this.trigger(F,{item:e(t.currentTarget)})},_optionLabel:function(){var e=this.options.optionLabel;e&&"object"==typeof e?(this.element.before("<ul class='"+C+"'><li tabindex='-1' class='"+A+"' role='option'><div class='"+D+"'></div></li></ul>"),this.optionLabel=this.wrapper.find("."+A),g.call(this,this.optionLabel,{index:-1,top:null,selected:!1,current:!1,item:e},this.templates),this.optionInstance=e):this.optionInstance=null},_buildValueGetter:function(){this._valueGetter=m.getter(this.options.dataValueField)}});m.ui.VirtualList=N,m.ui.plugin(N)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});