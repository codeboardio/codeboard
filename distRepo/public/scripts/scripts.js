"use strict";var app;(app=angular.module("codeboardApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","ui.ace","angularTreeview","angularScreenfull","ui.bootstrap","angularFileUpload","ui.select","ngGrid","kendo.directives","chart.js","ngWebSocket","luegg.directives"])).config(["ChartJsProvider",function(e){e.setOptions({colours:["#949FB1","#97BBCD"],responsive:!0,maintainAspectRatio:!1,pointHitDetectionRadius:1})}]),app.config(["$logProvider",function(e){e.debugEnabled(!1)}]),app.config(["uiSelectConfig",function(e){e.theme="selectize"}]),app.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"partials/main",controller:"MainCtrl"}).when("/signin",{templateUrl:"partials/signin",controller:"SigninCtrl"}).when("/signup",{templateUrl:"partials/signup",controller:"SignupCtrl"}).when("/passwordreset",{templateUrl:"partials/passwordReset",controller:"PasswordResetCtrl"}).when("/users",{templateUrl:"partials/usersAll",controller:"usersAllCtrl"}).when("/users/:username/settings/",{templateUrl:"partials/userSettings",controller:"UserSettingsCtrl",resolve:{userData:["$route","UserResSettings",function(e,t){return t.get({username:e.current.params.username}).$promise}]}}).when("/users/:username",{templateUrl:"partials/userProjects",controller:"UserProjectsCtrl"}).when("/projects/new",{templateUrl:"partials/projectNew",controller:"ProjectNewCtrl",resolve:{isAuth:["$q","UserSrv",function(e,t){var r=e.defer();return t.isAuthenticated()?r.resolve():r.reject({status:401}),r.promise}]}}).when("/projects/:projectId/settings",{templateUrl:"partials/projectSettings",controller:"ProjectSettingsCtrl",resolve:{projectData:["$route","ProjectSettingsRes",function(e,t){return t.get({projectId:e.current.params.projectId}).$promise}]}}).when("/projects/:projectId/summary",{templateUrl:"partials/projectSummary",controller:"ProjectSummaryCtrl",resolve:{projectSummaryData:["$route","ProjectSummaryRes",function(e,t){return t.get({projectId:e.current.params.projectId}).$promise}]}}).when("/projects/:projectId/stats",{templateUrl:"partials/projectStats",controller:"ProjectStatsCtrl",resolve:{placeHolder:["$route","$http",function(e,t){return t.get("/api/projects/"+e.current.params.projectId+"/authorizedownercheck")}]}}).when("/projects/:projectId/submissions",{templateUrl:"partials/projectSubmissions",controller:"ProjectSubmissionsCtrl",resolve:{placeHolder:["$route","$http",function(e,t){return t.get("/api/projects/"+e.current.params.projectId+"/authorizedownercheck")}]}}).when("/projects/:projectId/userprojects",{templateUrl:"partials/projectUserProjects",controller:"ProjectUserProjectsCtrl",resolve:{placeHolder:["$route","$http",function(e,t){return t.get("/api/projects/"+e.current.params.projectId+"/authorizedownercheck")}]}}).when("/projects/:projectId",{templateUrl:"partials/ide",controller:"IdeCtrl",resolve:{ltiData:["$route","$q",function(e,t){var r=t.defer(),o={};return e.current.params.ltiSessionId&&(o.ltiSessionId=e.current.params.ltiSessionId),e.current.params.ltiUserId&&(o.ltiUserId=e.current.params.ltiUserId),e.current.params.ltiNonce&&(o.ltiNonce=e.current.params.ltiNonce),r.resolve(o),r.promise}],projectData:["$route","ProjectRes",function(e,t){var r,o=(r=[],e.current.params.ltiSessionId&&r.push(e.current.params.ltiSessionId),e.current.params.ltiUserId&&r.push(e.current.params.ltiUserId),e.current.params.ltiNonce&&r.push(e.current.params.ltiNonce),r);return 3==o.length?t.get({projectId:e.current.params.projectId,ltiSessionId:o[0],ltiUserId:o[1],ltiNonce:o[2]}).$promise:t.get({projectId:e.current.params.projectId}).$promise}]}}).when("/projects/:projectId/submissions/:submissionId",{templateUrl:"partials/ide",controller:"IdeCtrl",resolve:{ltiData:["$route","$q",function(e,t){var r=t.defer();return r.resolve({}),r.promise}],projectData:["$route","$http",function(e,t){return t.get("/api/projects/"+e.current.params.projectId+"/submissions/"+e.current.params.submissionId).then(function(e){var t={projectname:e.data.project.projectname,language:e.data.project.language,userRole:"submission",username:e.data.user.username};t.fileSet=e.data.userFilesDump.concat(e.data.hiddenFilesDump);var r=0;return t.fileSet.every(function(e){e.uniqueId>r&&(r=e.uniqueId)}),t.lastUId=r,t.isSubmissionAllowed=!1,t})}]}}).when("/projects/:projectId/userprojects/:userprojectId",{templateUrl:"partials/ide",controller:"IdeCtrl",resolve:{ltiData:["$route","$q",function(e,t){var r=t.defer();return r.resolve({}),r.promise}],projectData:["$route","UserProjectRes",function(e,t){return t.get({projectId:e.current.params.projectId,userprojectId:e.current.params.userprojectId}).$promise}]}}).when("/projects",{templateUrl:"partials/projectsAll",controller:"projectsAllCtrl"}).when("/support/lti/debug",{templateUrl:"partials/supportLtiDebug",controller:"SupportCtrl"}).when("/404",{templateUrl:"partials/404"}).when("/401",{templateUrl:"partials/401"}).otherwise({redirectTo:"/404"}),t.html5Mode(!0)}]),app.run(["$rootScope","$route","$location","UserSrv",function(e,t,n,s){e.$on("$routeChangeStart",function(e,t,r,o){window.onbeforeunload=null,s.isAuthenticated()||s.tryAuthenticateUser()}),e.$on("$routeChangeError",function(e,t,r,o){401===o.status?n.path("/401").replace():n.path("/404").replace()})}]),angular.module("codeboardApp").controller("MainCtrl",["$scope","$rootScope","$http","$location","UserSrv",function(n,e,r,s,t){n.authFailed=!1,n.init=void(t.isAuthenticated()&&s.path("/users/"+t.getUsername())),n.login=function(e){n.authFailed=!1;var t={username:e.username,password:e.password};r.post("/api/session",t).success(function(e,t,r,o){s.path("/users/"+e.username)}).error(function(e,t,r,o){console.log("Auth failed"),n.authFailed=!0})}}]),angular.module("codeboardApp").controller("NavbarCtrl",["$scope","$location","UserSrv",function(r,e,o){r.username=o.getUsername(),r.isAuth=o.isAuthenticated(),r.$on("userLoggedIn",function(e,t){r.username=o.getUsername(),r.isAuth=o.isAuthenticated()}),r.signOut=function(){o.signOutUser()}}]),angular.module("codeboardApp").controller("SignupCtrl",["$scope","$rootScope","$http","$location",function(n,e,s,a){n.data={},n.serverError={userExists:!1,emailExists:!1,hasErrors:!1,errorMsg:""},n.submitted=!1,n.currentlySubmitting=!1,n.register=function(e){if(n.submitted=!0,e.$valid&n.data.password===n.data.passwordConfirm&&0==n.currentlySubmitting){n.currentlySubmitting=!0;var t={username:n.data.username,password:n.data.password,email:n.data.email};s.post("/api/users",t).success(function(e,t,r,o){n.serverError.userExists=!1,n.serverError.emailExists=!1,n.currentlySubmitting=!1,s.post("/api/session",{username:n.data.username,password:n.data.password}).success(function(e,t,r,o){a.path("/users/"+e.username)})}).error(function(e,t){422===t?(n.serverError.hasErrors=!0,n.serverError.errorMsg=e.msg):409===t?("UserExists"===e.error&&(n.serverError.userExists=!0),"EmailExists"===e.error&&(n.serverError.emailExists=!0)):(n.serverError.hasErrors=!0,n.serverError.errorMsg=e.msg),n.currentlySubmitting=!1})}}}]),angular.module("codeboardApp").controller("SigninCtrl",["$scope","$rootScope","$http","$location","$routeParams",function(r,e,o,n,s){r.formData={},r.signinFailed=!1,r.signin=function(e){r.submitted=!0;var t={username:e.username,password:e.password};o.post("/api/session",t).success(function(e,t,r,o){s.redirect?n.url(s.redirect):n.path("/users/"+e.username)}).error(function(e,t){r.signinFailed=!0,r.formData.error=401===t?"Invalid username, email or password.":"Unknown error. Please try again."})}}]),angular.module("codeboardApp").controller("PasswordResetCtrl",["$scope","$rootScope","$http","$location","$routeParams",function(n,e,r,t,o){n.formData={},n.submitted=!1,n.isUnderSubmission=!1,n.server={resetSuccess:!1,errorUnknownFailure:!1,errorEmailUnknown:!1},n.resetPassword=function(e){n.submitted=!0,n.isUnderSubmission=!0,n.server.resetSuccess=!1,n.server.errorEmailUnknown=!1,n.server.errorUnknownFailure=!1;var t={email:e.email};r.put("/api/passwordreset",t).success(function(e,t,r,o){n.server.resetSuccess=!0,n.isUnderSubmission=!1}).error(function(e,t){n.isUnderSubmission=!1,403===t?n.server.errorEmailUnknown=!0:n.server.errorUnknownFailure=!0})}}]),(app=angular.module("codeboardApp")).controller("IdeCtrl",["$scope","$rootScope","$log","$sce","$location","$routeParams","$window","$http","$timeout","$uibModal","ProjectFactory","projectData","ltiData","IdeMsgService","IdeSnippetsSrv","UserSrv","WebsocketSrv",function(a,c,u,o,e,d,t,i,r,n,l,s,p,m,g,f,h){l.setProjectFromJSONdata(s,p);t.onbeforeunload=function(e){var t="You currently have unsaved changes.";return v(),void 0===e&&(e=window.event),e&&l.isProjectModified()?e.returnValue=t:null},a.$on("$locationChangeStart",function(e){if(v(),l.isProjectModified()){confirm("You currently have unsaved changes.\n\nAre you sure you want to leave this page?")||e.preventDefault()}});function b(e,t,r){var o=0,n=r||!a.isCompilationNeeded();S("",n),h.connect(e,function(){i.get(t).then(function(e){u.debug("websocketSrvjs.onOpen: container successfully started"),w.actionAllowsForStopping&&c.$broadcast(m.msgStoppableActionAvailable().msg)},function(e){u.debug("websocketSrvjs.onOpen: problem starting container."),u.debug(e)})},function(e){var t=j(e,n);o+=1,15e3<t&&(j("\n\nYour program output has more than 15000 characters. That's quite a lot.\nFor this reason, Codeboard has terminated your program.\n\n",n),h.close(!0))},function(){0===o&&j("--Session ended without output.--",!1),c.$broadcast(m.msgStoppableActionGone().msg),R(1,1,1,1,1)})}var v=function(){-1!==a.ace.currentNodeId&&(l.getNode(a.ace.currentNodeId).content=a.ace.editor.getSession().getValue())},S=function(e,t){a.renderHtmlOutput=!1,t&&!a.uiSettings.showOutputAsText?(a.output="",a.htmlOutput=o.trustAsHtml(e),a.renderHtmlOutput=!0):(a.output=e,a.htmlOutput="",a.renderHtmlOutput=!1)};S("This will display the output.",!1);var j=function(e,t){if(a.renderHtmlOutput=!1,t&&!a.uiSettings.showOutputAsText){var r=a.htmlOutput+e;a.htmlOutput=o.trustAsHtml(r),a.renderHtmlOutput=!0}else a.output+=e,a.renderHtmlOutput=!1;return a.output.length+(a.htmlOutput.$$unwrapTrustedValue?a.htmlOutput.$$unwrapTrustedValue().length:0)};"WebSocket"in window&&("function"==typeof WebSocket||"object"==typeof WebSocket)?u.debug("Info: Browser supports WebSockets"):S("Warning: your browser does not support WebSockets.\nThis may cause Codeboard to not work properly.\nPlease consider updating to a newer browser.",!1);function $(e){v(),S("Waiting for (previous) results...",!1),R(0,0,0,0,0),l.compileProject(e).then(function(e){w.stopUrl=e.stopUrl,b(e.streamUrl,e.startUrl)},function(e){u.debug("Error while trying to run your program. The server responded:\n"+e),S("Error while trying to run your program. The server responded:\n"+e,!1),R(1,0,0,1,0),c.$broadcast(m.msgStoppableActionGone().msg)})}function y(){v(),S("Submitting your solution. This might take a few seconds. Please wait...",!1),R(0,0,0,0,0),l.submitProject().then(function(e){u.debug("Submission successful."),S(e.msg,!1),R(1,0,1,1,1)},function(e){u.debug("Submission failed."+e.data.msg),S(e.data.msg,!1),R(1,0,1,1,1)})}var I,w={actionAllowsForStopping:!1,stopUrl:""};a.projectName=l.getProject().name,a.ace={currentNodeId:-1,editor:null,isVisible:!1},a.aceLoaded=function(e){a.ace.editor=e},a.uiSettings={showSubmissionBtn:s.isSubmissionAllowed,showOutputAsText:!1},a.disabledActions={compile:!1,run:!0,stop:!0,test:!0,tool:!1,submit:!0},a.hiddenActions={compileDynamic:!1,run:!1,stop:!0},a.aceEditorSettings={theme:"eclipse",fontSize:"12px",handler:"ace",tabSize:4,invisibles:"Hide",gutter:"Show"},a.signinSettings={userIsAuthenticated:function(){return f.isAuthenticated()},signinPathWithRedirect:function(){return"/signin?redirect="+encodeURIComponent(e.url())}};var R=function(e,t,r,o,n){a.disabledActions.compile=!(1==e),a.disabledActions.run=!(1==t),a.disabledActions.test=!(1==r),a.disabledActions.tool=!(1==o),a.disabledActions.submit=0,a.$$phase||a.$digest()};a.currentUserIsOwner=function(){return"owner"===l.getProject().userRole},a.currentRoleIsOwner=function(){return"owner"===l.getProject().userRole},a.currentRoleIsUser=function(){return"user"===l.getProject().userRole},a.currentRoleIsSubmission=function(){return"submission"===l.getProject().userRole},a.currentRoleIsUserProject=function(){return"userproject"===l.getProject().userRole},a.navBarClick=function(e){switch(u.debug("NavBarClick with id: "+e),e){case"add_file":var t=m.msgNewNodeRequest("file");c.$broadcast(t.msg,t.data);break;case"add_folder":t=m.msgNewNodeRequest("folder");c.$broadcast(t.msg,t.data);break;case"rename_node":t=m.msgRenameNodeRequest();c.$broadcast(t.msg);break;case"remove_node":t=m.msgRemoveNodeRequest();c.$broadcast(t.msg);break;case"save_project":t=m.msgSaveProjectRequest();c.$broadcast(t.msg);break;case"hide_file":t=m.msgHideNodeRequest();c.$broadcast(t.msg);break;case"show_share_project":t=m.msgShowShareProjectModalRequest();c.$broadcast(t.msg);break;case"show_editor_settings":t=m.msgShowEditorSettingsRequest(a.aceEditorSettings);c.$broadcast(t.msg,t.data);break;case"show_output_as_text":t=m.msgShowOutputAsText();c.$broadcast(t.msg);break;case"compile":if(!a.disabledActions.compile){t=m.msgCompileRequest();c.$broadcast(t.msg)}break;case"compileDynamic":if(!a.disabledActions.compile){t=m.msgCompileRequest();c.$broadcast(t.msg),w.actionAllowsForStopping=!0}break;case"compile_clean":if(!a.disabledActions.compile){t=m.msgCompileCleanRequest();c.$broadcast(t.msg)}break;case"run":if(!a.disabledActions.run){t=m.msgRunRequest();c.$broadcast(t.msg),w.actionAllowsForStopping=!0}break;case"stop":t=m.msgStopRequest();c.$broadcast(t.msg);break;case"test":if(!a.disabledActions.test){t=m.msgTestRequest();c.$broadcast(t.msg)}break;case"tool":if(!a.disabledActions.tool){t=m.msgToolRequest();c.$broadcast(t.msg)}break;case"submit":if(!a.disabledActions.submit){t=m.msgSubmitRequest();c.$broadcast(t.msg)}break;case"submitio":t=m.msgSubmitRequest();c.$broadcast(t.msg)}},a.$on(m.msgDisplayFileRequest().msg,function(e,t){if(-1!==a.ace.currentNodeId&&(l.getNode(a.ace.currentNodeId).session=a.ace.editor.getSession(),l.getNode(a.ace.currentNodeId).content=a.ace.editor.getSession().getValue()),void 0!==l.getNode(t.nodeId).session&&null!==l.getNode(t.nodeId).session)a.ace.editor.setSession(l.getNode(t.nodeId).session);else{var r=l.getNode(t.nodeId),o=r.content,n="ace/mode/text";switch(r.filename.split(".").pop()){case"e":n="ace/mode/eiffel";break;case"ecf":n="ace/mode/xml";break;case"java":n="ace/mode/java";break;case"html":case"htm":n="ace/mode/html";break;case"py":n="ace/mode/python";break;case"c":case"h":case"cpp":n="ace/mode/c_cpp";break;case"hs":n="ace/mode/haskell";break;case"json":n="ace/mode/json";break;default:n="ace/mode/text"}a.ace.editor.setSession(ace.createEditSession(o,n)),I=a.ace.editor.getKeyboardHandler(),"ace/mode/haskell"===n?a.ace.editor.getSession().setTabSize(8):a.ace.editor.getSession().setTabSize(4);var s=ace.require("ace/snippets").snippetManager;ace.require("ace/config");ace.config.loadModule("ace/ext/language_tools",function(){a.ace.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1})}),"ace/mode/eiffel"==n&&ace.config.loadModule("ace/snippets/eiffel",function(e){if(e){(s.files.eiffel=e).snippetText="snippet feature modifier\n\tfeature {${1:CLASS}} -- ${2:comment}  \n",e.snippets=s.parseSnippetFile(e.snippetText);for(var t=0;t<g.getEiffelSnippet().length;t++)e.snippets.push(g.getEiffelSnippet()[t]);s.register(e.snippets,e.scope)}}),r.url&&!r.isContentSet&&i.get(r.url).success(function(e){u.debug("Got HTTP response for content of the file"),l.getNode(t.nodeId).content=e,l.getNode(t.nodeId).isContentSet=!0,a.ace.editor.getSession().setValue(e)}).error(function(e){u.debug(e)})}"string"==typeof t.nodeId&&"s"===t.nodeId.charAt(0)?a.ace.editor.setReadOnly(!0):a.ace.editor.setReadOnly(!1),a.ace.currentNodeId=t.nodeId,a.ace.editor.focus()}),a.splitterResizeEvent=function(){var e=m.msgEditorResizeRequest();c.$broadcast(e.msg)},a.$on(m.msgEditorResizeRequest().msg,function(){a.ace.editor.resize()}),a.$on(m.msgSaveProjectRequest().msg,function(){u.debug("Save request received"),v(),l.saveProjectToServer().then(function(e){S('<span style="color: green;">Changes successfully saved.</span>',!0),r(function(){S("This will display the output.",!1)},2500)},function(e){S('<span style="color: red">WARNING: Unable to save your changes.<br><br>What now: maybe you\'re currently not logged in.<br>Open a new browser tab for codeboard.io, login, and then come back to this tab and try to save your changes.<br>If the problem persists, contact us at: info@codeboard.io</span>',!0)}),a.ace.editor.focus()}),a.$on(m.msgShowEditorSettingsRequest().msg,function(e,s){var t,r,o=["$rootScope","$scope","$uibModalInstance",function(t,r,o){var n=angular.copy(s.settings);r.editorSettings=angular.copy(s.settings),r.ok=function(){var e=m.msgEditorSettingsChanged(r.editorSettings);t.$broadcast(e.msg,e.data),o.close()},r.preview=function(){var e=m.msgEditorSettingsChanged(r.editorSettings);t.$broadcast(e.msg,e.data)},r.cancel=function(){var e=m.msgEditorSettingsChanged(n);t.$broadcast(e.msg,e.data),o.dismiss()}}];t=function(){},r=function(){},n.open({templateUrl:"ideEditorSettingsModal.html",controller:o}).result.then(function(){u.debug("User confirmed changes to editor settings."),t&&t()},function(){u.debug("User canceled changes to editor settings."),r&&r()})}),a.$on(m.msgEditorSettingsChanged().msg,function(e,t){a.aceEditorSettings=t.settings,"ace"!=a.aceEditorSettings.handler?a.ace.editor.setKeyboardHandler("ace/keyboard/"+a.aceEditorSettings.handler):a.ace.editor.setKeyboardHandler(I),a.ace.editor.setTheme("ace/theme/"+a.aceEditorSettings.theme),a.ace.editor.setFontSize(a.aceEditorSettings.fontSize),a.ace.editor.getSession().setTabSize(a.aceEditorSettings.tabSize),"Show"===a.aceEditorSettings.invisibles?a.ace.editor.setShowInvisibles(!0):a.ace.editor.setShowInvisibles(!1),"Show"===a.aceEditorSettings.gutter?a.ace.editor.renderer.setShowGutter(!0):a.ace.editor.renderer.setShowGutter(!1)}),a.$on(m.msgShowOutputAsText().msg,function(){a.uiSettings.showOutputAsText=!a.uiSettings.showOutputAsText}),a.$on(m.msgCompileRequest().msg,function(){u.debug("Compile request received"),$(!1),a.ace.editor.focus()}),a.$on(m.msgCompileCleanRequest().msg,function(){u.debug("Clean-compile request received"),$(!0),a.ace.editor.focus()}),a.$on(m.msgRunRequest().msg,function(){u.debug("Run request received"),S("Waiting for results...",!1),R(0,0,0,0,0),l.runProject().then(function(e){w.stopUrl=e.stopUrl,b(e.streamUrl,e.startUrl,!0)},function(e){u.debug("Error when trying to run your program. The server responded:\n"+e),S("Error when trying to run your program. The server responded:\n"+e,!1),R(1,0,0,1,0),c.$broadcast(m.msgStoppableActionGone().msg)}),a.ace.editor.focus()}),a.$on(m.msgStopRequest().msg,function(){u.debug("Stop request received"),w.stopUrl&&i.get(w.stopUrl).success(function(e,t,r,o){j("\n\n--Program stopped--",!0)}).error(function(e,t,r,o){u.debug("An error occurred while trying to stop your program."),j("\n\nAn error occurred while trying to stop your program.",!0)})}),a.$on(m.msgTestRequest().msg,function(){u.debug("Test request received"),v(),S("Testing your solution. This might take a few seconds. Please wait...",!1),R(0,0,0,0,0),l.testProject().then(function(e){u.debug("Testing successful."),e.compilationError?S("Testing failed. Your program does not compile.\nFix all compilation errors and try again.\n\n--- Details ---\n\n"+e.outputCompiler,!1):S("Number of passing tests: "+e.numTestsPassing+"\nNumber of failing tests: "+e.numTestsFailing+"\n\n--- Details ---\n\n"+e.output,!1),R(1,0,1,1,1)},function(e){u.debug("Error while trying to test your program. The server responded:\n"+e),S("Error while trying to test your program. The server responded:\n"+e,!1),R(1,0,1,1,0)}),a.ace.editor.focus()}),a.$on(m.msgToolRequest().msg,function(){u.debug("Tool request received"),v(),S("Analyzing your project. This might take a few seconds. Please wait...",!1),R(0,0,0,0,0),l.toolAction().then(function(e){u.debug("Tool action successful."),e.compilationError?S("Analysis failed. Your program does not compile.\nFix all compilation errors and try again.\n\n--- Details ---\n\n"+e.outputCompiler,!1):S(e.output,!1),R(1,0,1,1,1)},function(e){u.debug("Error while running the tool-action on your program. The server responded:\n"+e),S("Error while running the requested action on your program. The server responded:\n"+e,!1),R(1,0,1,1,0)}),a.ace.editor.focus()}),a.$on(m.msgSubmitRequest().msg,function(){if(u.debug("Submit request received"),f.isAuthenticated()||l.getProject().hasLtiData)y();else{var e=["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()},e.cancel=function(){t.dismiss()}}];t=y,n.open({templateUrl:"ideConfirmAnonymousSubmissionModal.html",controller:e}).result.then(function(){u.debug("User confirmed submit anonymously."),t&&t()},function(){u.debug("User canceled anonymous submission."),r&&r()})}var t,r;a.ace.editor.focus()}),a.$on(m.msgDisplayEditorRequest().msg,function(e,t){t.displayEditor?a.ace.isVisible=!0:a.ace.isVisible=!1}),a.$on(m.msgRemoveNodeConfirmation().msg,function(e,t){a.ace.currentNodeId===t.uniqueId&&(a.ace.currentNodeId=-1)}),a.$on(m.msgStoppableActionAvailable().msg,function(){u.debug("Event received: Stoppable action available"),a.hiddenActions.compileDynamic=!0,a.hiddenActions.run=!0,a.hiddenActions.stop=!1}),a.$on(m.msgStoppableActionGone().msg,function(){u.debug("Event received: Stoppable action gone"),a.hiddenActions.compileDynamic=!1,a.hiddenActions.run=!1,a.hiddenActions.stop=!0,w.actionAllowsForStopping=!1}),a.$on(m.msgProcessViewQueryStringRequest().msg,function(){r(function(){!function(){if(d.view){u.debug('idejs.processViewQueryString: Found a "view" query string in the URL: '+d.view);for(var e=[],t=d.view.split("-"),r=0;r<t.length;r++){var o=t[r].split(".");if(2!=o.length||!isNaN(o[0])||!isNaN(o[1])){var n=parseInt(o[0]),s=parseInt(o[1]);if(l.hasNode(n)&&!l.getNode(n).isFolder){var a={nodeId:n,nodeActive:s};e.push(a)}}}for(r=0;r<e.length;r++){var i=m.msgDisplayFileRequest(e[r].nodeId);c.$broadcast(i.msg,i.data)}for(r=0;r<e.length;r++)if(e[r].nodeActive){i=m.msgDisplayFileRequest(e[r].nodeId);c.$broadcast(i.msg,i.data)}}}()})}),a.isCompilationNeeded=function(){var e=!0;return-1!==["Python","Python-UnitTest"].indexOf(l.getProject().language)&&(e=!1),e},a.isTestSupported=function(){return!0},a.isToolSupported=function(){var e=!1;return-1!==["Infer-Java"].indexOf(l.getProject().language)&&(e=!0),e},a.isEiffelLanguageCompatible=function(){return"Eiffel"===l.getProject().language},a.sendUserInputClick=function(e,t){e?h.sendData(e+"\n"):h.sendData("\n");var r=angular.element(document.querySelector("#"+t));r&&r.focus()},function(){if("user"==l.getProject().userRole&&f.isAuthenticated()){var e="/api/users/"+f.getUsername()+"/projects/"+d.projectId;d.ltiSessionId&&d.ltiUserId&&d.ltiNonce&&(e+="?ltiSessionId="+d.ltiSessionId+"&ltiUserId="+d.ltiUserId+"&ltiNonce="+d.ltiNonce),i.get(e).success(function(t){var e,r,o=["$scope","$uibModalInstance","UserSrv",function(e,t,r){e.ok=function(){t.close()},e.cancel=function(){t.dismiss()},e.getUsername=function(){return r.getUsername()}}];e=function(){var e={name:l.getProject().name,lastUId:t.project.lastUId,language:l.getProject().language,userRole:l.getProject().userRole,fileSet:t.files};l.setProjectFromJSONdata(e,p,l.getProject().staticFiles),c.$broadcast(m.msgReloadTreeFromProjectFactory().msg)},n.open({templateUrl:"ideLoadUserProjectModal.html",controller:o}).result.then(function(){u.debug("User confirmed to load saved project."),e&&e(),c.$broadcast(m.msgProcessViewQueryStringRequest().msg)},function(){u.debug("User canceled loading of the saved project."),r&&r(),c.$broadcast(m.msgProcessViewQueryStringRequest().msg)})}).error(function(e){u.debug(e),c.$broadcast(m.msgProcessViewQueryStringRequest().msg)})}else c.$broadcast(m.msgProcessViewQueryStringRequest().msg)}()}]),app.controller("TreeCtrl",["$scope","$rootScope","$log","ProjectFactory","IdeMsgService",function(s,a,t,i,c){s.projectNodes=i.getProject().files,s.addFile=function(){var e=c.msgNewNodeRequest("file");a.$broadcast(e.msg,e.data)},s.addFolder=function(){var e=c.msgNewNodeRequest("folder");a.$broadcast(e.msg,e.data)},s.nodeClick=function(){var e=i.getNode(s.mytree.currentNode.uniqueId);if(null!=e&&!e.isFolder){var t=c.msgDisplayFileRequest(e.uniqueId);a.$broadcast(t.msg,t.data)}},s.$on(c.msgRenameNodeRequest().msg,function(e){if(0===s.mytree.currentNode.uniqueId)alert("The root folder can't be renamed.");else{var t=s.mytree.currentNode.uniqueId,r=i.getNode(t).filename,o=i.getNode(t).isFolder?"folder":"file",n=c.msgDisplayRenameNodeModalRequest(t,r,o);a.$broadcast(n.msg,n.data)}}),s.$on(c.msgRenameNodeNameAvailable().msg,function(e,t){i.renameNode(t.nodeId,t.nodeName),a.$broadcast(c.msgReloadTreeFromProjectFactory().msg)}),s.$on(c.msgRemoveNodeRequest().msg,function(e){if(0===s.mytree.currentNode.uniqueId)alert("The root folder can't be deleted.");else{var t=i.getNode(s.mytree.currentNode.uniqueId).filename,r="Do you really want to delete "+(i.getNode(s.mytree.currentNode.uniqueId).isFolder?"folder":"file")+" '"+t+"'?";r=i.getNode(s.mytree.currentNode.uniqueId).isFolder?r+"\n\nNote: when deleting a folder, make sure it's empty.":r;if(confirm(r)){var o=s.mytree.currentNode.uniqueId;i.removeNode(o,!1),i.getNode(0).selected="selected",s.mytree.currentNode=i.getNode(0);var n=c.msgRemoveNodeConfirmation(o);a.$broadcast(n.msg,n.data)}}}),s.$on(c.msgNewNodeNameAvailable().msg,function(e,t){var r=s.mytree.currentNode.uniqueId;switch(t.nodeType){case"file":i.addFile(r,t.nodeName);break;case"folder":i.addFolder(r,t.nodeName)}}),s.$on(c.msgReloadTreeFromProjectFactory().msg,function(e){s.projectNodes=i.getProject().files}),s.$on(c.msgHideNodeRequest().msg,function(){t.debug("Hide_node request received");var e=s.mytree.currentNode.uniqueId;0<e?(t.debug("Node is hidden: "+i.getNode(e).isHidden),i.setNodeHidden(i.getNode(e)),t.debug("Node is hidden: "+i.getNode(e).isHidden)):alert("The root folder can't be hidden.")})}]),app.controller("TabCtrl",["$scope","$rootScope","$log","$uibModal","ProjectFactory","IdeMsgService",function(a,s,o,n,i,c){a.tabs=[];function u(e){for(var t=0;t<a.tabs.length;t++)a.tabs[t].isActive=t===e}function d(e){for(var t=0;t<a.tabs.length;t++)if(a.tabs[t].nodeIndex===e)return t;return-1}a.selectClick=function(e){var t=c.msgDisplayFileRequest(a.tabs[e].nodeIndex);s.$broadcast(t.msg,t.data)},a.closeClick=function(e){o.debug("Close-tab clicked; array-index:"+e);for(var t=e+1;t<a.tabs.length;t++)a.tabs[t].arrayIndex=a.tabs[t].arrayIndex-1;if(a.tabs[e].isActive)if(1===a.tabs.length){var r=c.msgDisplayEditorRequest(!1);s.$broadcast(r.msg,r.data)}else if(0===e){r=c.msgDisplayFileRequest(a.tabs[e+1].nodeIndex);s.$broadcast(r.msg,r.data)}else{r=c.msgDisplayFileRequest(a.tabs[e-1].nodeIndex);s.$broadcast(r.msg,r.data)}a.tabs.splice(e,1)},a.$on(c.msgDisplayFileRequest().msg,function(e,t){if(0===a.tabs.length){var r=c.msgDisplayEditorRequest(!0);s.$broadcast(r.msg,r.data)}var o=d(t.nodeId);if(-1===o){var n=i.getNode(t.nodeId);a.tabs.push({name:n.filename,title:n.path+"/"+n.filename,nodeIndex:t.nodeId,arrayIndex:a.tabs.length,isActive:!1}),u(a.tabs.length-1)}else u(o)}),a.$on(c.msgRenameNodeNameAvailable().msg,function(e,t){var r=d(t.nodeId);-1!==r&&(a.tabs[r].name=t.nodeName)}),a.$on(c.msgRemoveNodeConfirmation().msg,function(e,t){var r=d(t.uniqueId);-1!==r&&a.closeClick(r)}),a.$on(c.msgShowShareProjectModalRequest().msg,function(e,t){var s=a.tabs,r=["$rootScope","$scope","$location","$uibModalInstance",function(e,r,o,t){function n(){var e=o.absUrl(),t=e.indexOf("?");return 0<=t&&(e=e.substr(0,t)),e}r.form={inputText:n(),inputCheckbox:!1},r.checkboxChanged=function(){if(r.form.inputText=n(),r.form.inputCheckbox){var e="";if(0<s.length){e+="?view=";for(var t=0;t<s.length;t++)e+=s[t].nodeIndex+"."+(s[t].isActive?"1":"0"),e+=t<s.length-1?"-":""}r.form.inputText+=e}},r.closeModal=function(){t.close()}}];n.open({templateUrl:"ideShareProjectModal.html",controller:r})})}]),app.controller("LibraryCtrl",["$scope","$rootScope","$http","ProjectFactory","IdeMsgService",function(t,r,e,o,n){t.file={},t.files=[];e.get("staticfiles/eiffelfiles.json").success(function(e){t.files=e}).error(function(e){console.log(e)});t.showFile=function(){var e=n.msgDisplayFileRequest(t.file.selected.index);r.$broadcast(e.msg,e.data),t.file={}},t.foo=function(){alert("Click")},t.fetchStaticFiles=void e.get("staticfiles/eiffelfiles.json").success(function(e){o.getProject().staticFiles=e}).error(function(e){})}]),app.controller("IdeFooterStatusBarCtrl",["$scope","$routeParams","UserSrv","ProjectFactory",function(r,e,t,o){r.getUsername=function(){var e="User: ";return t.isAuthenticated()?e+=t.getUsername():e+='#anonymous (<a href="'+r.signinSettings.signinPathWithRedirect()+'">sign in</a> to save your progress)',e},r.getRole=function(){if(r.currentRoleIsOwner())return"Project owner";if(r.currentRoleIsUser())return"Project user";if(r.currentRoleIsSubmission()){var e="Inspection of a submission";return o.getProject().userBeingInspected&&(e='Inspecting submission from user "'+o.getProject().userBeingInspected+'"'),e}if(r.currentRoleIsUserProject()){var t="Inspection of a user's project";return o.getProject().userBeingInspected&&(t='Inspecting user-project from user "'+o.getProject().userBeingInspected+'"'),t}},r.isUsingLti=function(){return o.getProject().hasLtiData}}]),(app=angular.module("codeboardApp")).controller("IdeNodeActionCtrl",["$scope","$rootScope","$uibModal","$log","IdeMsgService",function(e,s,a,i,c){function u(r,e,t,o){var n=["$scope","$uibModalInstance","data",function(t,e,r){t.data={nodeName:r.nodeName,nodeType:r.nodeType,operationType:r.operationType},t.labels={heading:"Add file",label:"Enter the name of the new file:",btnOk:"Add file",btnCancel:"Cancel"};var o;r.operationType===l?(t.labels.heading="Rename "+r.nodeType,t.labels.label="Enter a new name for "+r.nodeName+":",t.labels.btnOk="Rename "+r.nodeType):r.operationType===d&&(t.labels.heading="Add "+r.nodeType,t.labels.label="Enter the name of the new "+r.nodeType+":",t.labels.btnOk="Add "+r.nodeType);t.ok=function(){e.close(t.data)},t.cancel=function(){e.dismiss("cancel")},t.submit=function(e){t.data.nodeName=e.nodeName,t.ok()},t.isValid=(o=/^[0-9a-zA-Z\-\_\.]+\.{1}[0-9a-zA-Z]{1,4}$/,t.data.nodeType===m&&(o=/^[0-9a-zA-Z\-\_\.]+$/),{test:function(e){return o.test(e)}}),t.getFormDataErrorMsg=function(){return t.data.nodeType===p?"Filename format: only use characters a-Z, numbers 0-9, '.', '-', and '_'. Make sure to provide a filename extension. Example: My_File.txt":"Foldername format: only use characters a-Z, numbers 0-9, '.', '-', and '_'. Example: My_Folder"}}];a.open({templateUrl:"ideNewNodeModal.html",controller:n,size:"sm",resolve:{data:function(){return{nodeName:e,nodeType:t,operationType:o}}}}).result.then(function(e){if(e.operationType===d){var t=c.msgNewNodeNameAvailable(e.nodeName,e.nodeType);s.$broadcast(t.msg,t.data)}else if(e.operationType===l){t=c.msgRenameNodeNameAvailable(r,e.nodeName);s.$broadcast(t.msg,t.data)}},function(){i.debug("Modal dismissed by user.")})}var d="add",l="rename",p="file",m="folder";e.$on(c.msgNewNodeRequest().msg,function(e,t){var r="file"===t.nodeType?p:m;u(-1,"",r,d)}),e.$on(c.msgDisplayRenameNodeModalRequest().msg,function(e,t){var r=t.nodeId,o=t.nodeName,n="file"===t.nodeType?p:m;u(r,o,n,l)})}]),angular.module("codeboardApp").controller("usersAllCtrl",["$scope","$http",function(t,e){t.users=[];e.get("/api/users").success(function(e){t.users=e}).error(function(e){})}]),angular.module("codeboardApp").controller("UserProjectsCtrl",["$scope","$rootScope","$routeParams","$http","$location","$route","UserSrv",function(t,e,r,o,n,s,a){t.user={},t.ownerSet={},t.userSet={},t.currentUserIsSelf=!1,t.init=void o.get("/api/users/"+r.username+"/projects").success(function(e){t.user={username:e.username,name:e.name,email:e.emailPublic,url:e.url,location:e.location,institution:e.institution,imageUrl:e.imageUrl},t.ownerSet=e.ownerSet,t.userSet=e.userSet,t.currentUserIsSelf=a.isAuthenticated()&&e.username===a.getUsername()}).error(function(e){n.path("/404").replace()})}]),angular.module("codeboardApp").controller("projectsAllCtrl",["$scope","$http",function(r,o){r.data={count:0,projects:[],hasNext:!1,next:"/api/projects"},r.featuredData={projects:[]},r.searchString="",r.searchTerms=[];o.get("/api/projects").success(function(e,t){r.data=e}).error(function(e){}),o.get("/api/projects/featured").success(function(e,t){r.featuredData=e}).error(function(e){});r.submitSearch=function(e){var t=e.trim();t=t.replace(/\s+/g," "),o.get("/api/projects?search="+encodeURIComponent(t)).success(function(e,t){r.data.count=e.count,r.data.projects=e.projects,r.data.hasNext=e.hasNext,r.data.next=e.next}).error(function(e){"422"===e.status&&""!==t&&(r.data.count=0,r.data.projects=[],r.data.hasNext=!1,r.data.next="/api/projects",r.searchTerms=e.searchTerms)})},r.showMore=function(){r.data.hasNext&&o.get(r.data.next).success(function(e,t){r.data.projects=r.data.projects.concat(e.projects),r.data.hasNext=e.hasNext,r.data.next=e.next}).error(function(e,t){})},r.display={search:!0,featured:!1},r.setDisplay=function(e){"search"===e&&(r.display.search=!0,r.display.featured=!1),"featured"===e&&(r.display.search=!1,r.display.featured=!0)}}]),angular.module("codeboardApp").controller("ProjectSettingsCtrl",["$scope","$http","$log","$routeParams","$location","$timeout","$uibModal","ProjectRes","projectData",function(n,s,t,a,r,i,e,o,c){n.data={},n.originalData={},n.projectId=a.projectId,n.server={saveSuccess:!1,saveFailure:!1},n.init=(angular.copy(c,n.originalData),n.data=c,n.data.ltiUri=location.protocol+"//"+location.hostname+"/lti/projects/"+n.data.id,n.data.ownerSet||(n.data.ownerSet=[]),void(n.data.userSet||(n.data.userSet=[]))),n.addOwners=function(e){n.data.ownerSet=u(n.data.ownerSet,e),n.input.newOwner=""},n.addUsers=function(e){n.data.userSet=u(n.data.userSet,e),n.input.newUser=""};var u=function(e,t){for(var r=t.split(","),o=[],n=0;n<r.length;n++){0<r[n].trim().length&&o.push({username:r[n].trim()})}return e.concat(o).sort(function(e,t){return e.username<t.username?-1:e.username>t.username?1:0})};n.removeMember=function(e,t){var r=-1;for(var o in e)e[o].username===t&&(r=o);e.splice(r,1)},n.discardChanges=function(){angular.copy(n.originalData,n.data)},n.save=function(e){var t=a.projectId;if(e.$valid){var r={projectname:n.data.projectname,description:n.data.description,language:n.data.language,isPrivate:n.data.isPrivate,ownerSet:[],userSet:[],isSubmissionAllowed:n.data.isSubmissionAllowed,isLtiAllowed:n.data.isLtiAllowed,ltiKey:n.data.ltiKey,ltiSecret:n.data.ltiSecret};for(var o in n.data.ownerSet)r.ownerSet.push(n.data.ownerSet[o].username);for(var o in n.data.userSet)r.userSet.push(n.data.userSet[o].username);n.server.saveSuccess=!1,n.server.saveFailure=!1,s.put("/api/projects/"+t+"/settings",r).success(function(e,t,r,o){n.server.saveSuccess=!0,i(function(){n.server.saveSuccess=!1},4e3)}).error(function(e,t,r,o){n.server.saveFailure=!0})}};var d=["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()},e.cancel=function(){t.dismiss()}}];n.openDeletionModal=function(){e.open({templateUrl:"DeletionModalContent.html",controller:d}).result.then(function(){t.debug("User confirmed deletion of project."),o.remove({projectId:a.projectId},function(e){t.debug("Deletion ok"),r.url("/")},function(e){t.debug("Deletion failed")})},function(){t.debug("User canceled deletion of project.")})}}]),angular.module("codeboardApp").controller("ProjectSummaryCtrl",["$scope","$http","$log","$routeParams","$location","projectSummaryData","UserSrv",function(e,t,r,o,n,s,a){e.prj=s,e.isCurrentUserProjectOwner=function(){return a.isAuthenticated()&&s.ownerSet.some(function(e,t,r){return e.username===a.getUsername()})}}]),angular.module("codeboardApp").controller("ProjectNewCtrl",["$scope","$http","$routeParams","$location","$route","$timeout",function(n,r,o,s,e,t){n.data={language:"Java-JUnit"},n.server={saveSuccess:!1,saveFailure:!1},n.save=function(e){o.projectId;if(e.$valid){var t={projectname:n.data.projectname,description:n.data.description,language:n.data.language,isPrivate:n.data.isPrivate};n.server.saveSuccess=!1,n.server.saveFailure=!1,r.post("/api/projects/",t).success(function(e,t,r,o){n.server.saveSuccess=!0,s.path("/projects/"+e.id+"/summary")}).error(function(e,t,r,o){n.server.saveFailure=!0})}}}]),angular.module("codeboardApp").controller("ProjectStatsCtrl",["$scope","$log","$route","$http","StatsSrv",function(n,t,r,o,s){n.fromDate=new Date,n.fromDate.setMonth(n.fromDate.getMonth()-1),n.untilDate=new Date,n.datePickerMaxSelectableDate=new Date,n.datePickerDateFormat="dd-MMMM-yyyy",n.datePickerFromOpen=!1,n.datePickerUntilOpen=!1,n.projectId=r.current.params.projectId,n.isLoadingCompilationRunGraphData=!0,n.isLoadingUserAccessGraphData=!0,n.compilationRunTableVisible=!1,n.projectAccessTableVisible=!1,n.submissionTableVisible=!1,n.isLoadingCompilationRunDetails=!1,n.isLoadingProjectAccessDetails=!1,n.isLoadingSubmissionsDetails=!1,n.compilationRunBtnLabel="Show user details",n.projectAccessBtnLabel="Show user details",n.submissionBtnLabel="Show user details",n.openDatePickerFrom=function(e){e.preventDefault(),e.stopPropagation(),n.datePickerFromOpen=!0},n.openDatePickerUntil=function(e){e.preventDefault(),e.stopPropagation(),n.datePickerUntilOpen=!0},n.updateFromDate=function(){n.fromDate>n.untilDate&&(n.untilDate=new Date(n.fromDate)),g()},n.updateUntilDate=function(){n.fromDate>n.untilDate&&(n.fromDate=new Date(n.untilDate)),g()};function a(e,t){var r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=1;20<e.length&&(o=Math.ceil(e.length/20));for(var n=0;n<e.length;n++)n%o==0?t.labels.push(r[e[n]._id.month-1]+" "+e[n]._id.day):t.labels.push("")}function i(e,t){for(var r=[],o=0;o<e.length;o++)r.push(e[o].count);t.data.push(r)}function e(){n.isLoadingCompilationRunGraphData=!0;var e=r.current.params.projectId;o.get("/api/log/user/summaryProjectCompilationRunDay/"+e,{params:{startDateLogs:n.fromDate,endDateLogs:n.untilDate}}).success(function(e){n.compilerSummaryLogs=e.compilerLogs,n.compilerSummaryRunLogs=e.compilerRunLogs,n.totalCompilationsDay="("+d(n.compilerSummaryLogs,"count")+")",n.totalRunsDay="("+d(n.compilerSummaryRunLogs,"count")+")",n.compileRunGraph={labels:[],series:[],data:[]},s.sortAndAddMissingDates(n.fromDate,n.untilDate,n.compilerSummaryLogs),s.sortAndAddMissingDates(n.fromDate,n.untilDate,n.compilerSummaryRunLogs),n.compileRunGraph.series.push("Compilations"),i(n.compilerSummaryLogs,n.compileRunGraph),n.compileRunGraph.series.push("Runs"),i(n.compilerSummaryRunLogs,n.compileRunGraph),a(n.compilerSummaryLogs,n.compileRunGraph),n.isLoadingCompilationRunGraphData=!1}).error(function(e){t.debug("Unable to get compile and run logs statistics (summary per day).")})}function c(){n.isLoadingUserAccessGraphData=!0;var e=r.current.params.projectId;o.get("/api/log/user/summaryProjectAccessDay/"+e,{params:{startDateLogs:n.fromDate,endDateLogs:n.untilDate}}).success(function(e){n.projectAccessPerDay=e.projectAccessPerDay,n.totalAccessPerDay="("+d(n.projectAccessPerDay,"count")+")",n.dataGraphUserAccess={labels:[],series:[],data:[]},s.sortAndAddMissingDates(n.fromDate,n.untilDate,n.projectAccessPerDay),n.dataGraphUserAccess.series.push("Project accesses"),i(n.projectAccessPerDay,n.dataGraphUserAccess),a(n.projectAccessPerDay,n.dataGraphUserAccess),n.isLoadingUserAccessGraphData=!1}).error(function(e){})}n.hideShowCompilationRunTable=function(){n.compilationRunTableVisible=!n.compilationRunTableVisible,n.compilationRunTableVisible?(n.compilationRunBtnLabel="Hide user details",l()):n.compilationRunBtnLabel="Show user details"},n.hideShowProjectAccessDetails=function(){n.projectAccessTableVisible=!n.projectAccessTableVisible,n.projectAccessTableVisible?(n.projectAccessBtnLabel="Hide user details",p()):n.projectAccessBtnLabel="Show user details"},n.hideShowSubmissionsDetails=function(){n.submissionTableVisible=!n.submissionTableVisible,n.submissionTableVisible?(n.submissionBtnLabel="Hide user details",m()):n.submissionBtnLabel="Show user details"},n.currentPageProjectAccess=0,n.currentPageCompilations=0,n.currentPageRuns=0,n.currentPageSubmissions=0,n.numPerPage=10,n.maxSizePage=10,n.filteredProjAccesses=[],n.filteredCompilations=[],n.filteredRuns=[],n.filteredSubmissions=[],n.pageChanged=function(e,t){var r=(e-1)*n.numPerPage,o=r+n.numPerPage;return null!=t?t.slice(r,o):[]},n.pageCompilationChanged=function(){n.filteredCompilations=n.pageChanged(n.currentPageCompilations,n.compilationStats)},n.pageRunsChanged=function(){n.filteredRuns=n.pageChanged(n.currentPageRuns,n.runStats)},n.pageProjectAccessChanged=function(){n.filteredProjAccesses=n.pageChanged(n.currentPageProjectAccess,n.accessStats)},n.pageSubmissionsChanged=function(){n.filteredSubmissions=n.pageChanged(n.currentPageSubmissions,n.submissionStats)};function u(e){e.sort(function(e,t){return e._id<t._id?-1:e._id>t._id?1:0})}var d=function(e,t){for(var r=0,o=0;o<e.length;o++)r+=e[o][t];return r},l=function(){n.isLoadingCompilationRunDetails=!0;var e=r.current.params.projectId;o.get("/api/log/user/summaryCompiler/"+e,{params:{startDateLogs:n.fromDate,endDateLogs:n.untilDate}}).success(function(e){n.compilationStats=e.compilerLogs,n.runStats=e.compilerRunLogs,n.totalCompilations=d(n.compilationStats,"countProjectAccess"),n.totalRuns=d(n.runStats,"countProjectAccess"),u(n.compilationStats),u(n.runStats),n.currentPageCompilations=1,n.pageCompilationChanged(),n.currentPageRuns=1,n.pageRunsChanged(),n.isLoadingCompilationRunDetails=!1}).error(function(e){t.debug("Unable to get compile and run logs statistics.")})},p=function(){n.isLoadingProjectAccessDetails=!0;var e=r.current.params.projectId;o.get("/api/log/user/summaryProjectAccess/"+e,{params:{startDateLogs:n.fromDate,endDateLogs:n.untilDate}}).success(function(e){n.accessStats=e.projectAccess,n.totalAccesses=d(n.accessStats,"countProjectAccess"),u(n.accessStats),n.currentPageProjectAccess=1,n.pageProjectAccessChanged(),n.isLoadingProjectAccessDetails=!1}).error(function(e){t.debug("Unable to get compile and run logs statistics.")})},m=function(){n.isLoadingSubmissionsDetails=!0;var e=r.current.params.projectId;o.get("/api/log/user/summarySubmitAccess/"+e,{params:{startDateLogs:n.fromDate,endDateLogs:n.untilDate}}).success(function(e){n.submissionStats=e.submitLogs,n.totalSubmissions=d(n.submissionStats,"countProjectAccess"),u(n.submissionStats),n.currentPageSubmissions=1,n.pageSubmissionsChanged(),n.isLoadingSubmissionsDetails=!1}).error(function(e){t.debug("Unable to get submission statistics.")})},g=function(){n.fromDate&&n.untilDate&&(e(),c(),n.compilationRunTableVisible&&l(),n.projectAccessTableVisible&&p(),n.submissionTableVisible&&m())};g()}]),angular.module("codeboardApp").controller("ProjectSubmissionsCtrl",["$scope","$log","$routeParams","$http",function(n,s,e,t){n.usernameFilter=void 0,n.projectId=e.projectId,n.submissionData=[];var r;r=e.projectId,t.get("/api/projects/"+r+"/submissions").success(function(e,t,r,o){n.submissionData=e}).error(function(e,t,r,o){s.debug("Can not get the submissions")})}]),angular.module("codeboardApp").controller("ProjectUserProjectsCtrl",["$scope","$log","$routeParams","$http",function(n,s,e,t){n.usernameFilter=void 0,n.projectId=e.projectId,n.userProjects=[];var r;r=e.projectId,t.get("/api/projects/"+r+"/userprojects").success(function(e,t,r,o){n.userProjects=e}).error(function(e,t,r,o){s.debug("Can not get the userprojects")})}]),angular.module("codeboardApp").controller("SupportCtrl",["$scope","$rootScope","$http","$routeParams","$location",function(n,e,r,o,t){n.data={reqBody:"",outcomeServiceUrl:"",sourcedId:"",responseHeader:"",responseBody:"",responseStatusCode:0};!function(){var e=JSON.parse(decodeURIComponent(o.reqBody)),t="";for(var r in e)t=t+r+"="+e[r]+"\n";n.data.reqBody=t,n.data.outcomeServiceUrl=e.lis_outcome_service_url,n.data.sourcedId=e.lis_result_sourcedid}();n.sendGrade=function(e){var t={grade:e,lis_outcome_service_url:n.data.outcomeServiceUrl,lis_result_sourcedid:n.data.sourcedId};r.put("/support/lti/debug/outcome",t).success(function(e,t,r,o){n.data.responseStatusCode=e.statusCode,n.data.responseHeader=e.headers,n.data.responseBody=e.body}).error(function(e,t,r,o){})}}]);var services=angular.module("codeboardApp");services.factory("ProjectFactory",["$http","$routeParams","$q","$log","ProjectRes","ProjectSubmissionRes",function(e,o,n,t,s,r){function c(){return f}function u(){b=v()}function d(e,t,r,o,n){var s={};return s.id=n.id||-1,s.filename=e,s.path=t,s.uniqueId=r,s.parentUId=o,s.isFolder=n.isFolder||!1,s.content=n.content||"",s.isHidden=n.isHidden||!1,s.isFolder&&(s.children=[]),s.isFolder||(s.session=null),s.filename_annotated=s.filename+S(s),s}function i(e){if("string"!=typeof e){var t=c().idToNodeMap[e];return t||null}if("s"===e.charAt(0)){var r=e.substring(1);c().staticFiles[r].url;return c().staticFiles[r].content||(c().staticFiles[r].content="-- Fetching file content. Please wait...",c().staticFiles[r].isContentSet=!1),c().staticFiles[r]}}function a(e,t){return t<e?1:e<t?-1:0}function l(e,t){return e.isFolder&&!t.isFolder?-1:!e.isFolder&&t.isFolder?1:e.isFolder&&t.isFolder?a(e.filename,t.filename):e.isFolder||t.isFolder?0:a(e.filename,t.filename)}function p(e,t){var r=c().idToNodeMap[e];if(r.isFolder){var o=d(t.filename,t.path,t.uniqueId,t.parentUId,{isFolder:t.isFolder,id:t.id,content:t.content,isHidden:t.isHidden});return c().idToNodeMap[o.uniqueId]=o,r.children.push(o),r.children.sort(l),o}return null}function m(e,t,r){var o=e,n=c().idToNodeMap[e];if(n.isFolder||(o=(n=c().idToNodeMap[n.parentUId]).uniqueId),n.isFolder){c().lastUId+=1;var s=""===n.path?"":n.path+"/",a=d(t,s+i(o).filename,c().lastUId,o,{isFolder:r});return c().idToNodeMap[a.uniqueId]=a,n.children.push(a),n.children.sort(l),a}return null}function g(e){var t=$(c().files),r={},o=[];for(var n in t)if(!t[n].isFolder){var s={filename:t[n].path+"/"+t[n].filename,content:t[n].content};o.push(s)}return r.files=o,r.language=c().language,r.action="compile",""===h||e||(r.id=h),r.hasLtiData=c().hasLtiData,r.ltiData=c().ltiData,r}var f={},h="",b="",v=function(){for(var e=$(c().files),t=[],r=0;r<e.length;r++){var o={filename:e[r].filename,path:e[r].path,uniqueUId:e[r].uniqueUId,parentUId:e[r].parentUId,isFolder:e[r].isFolder,content:e[r].content};t.push(o)}return new jsSHA(angular.toJson(t),"TEXT").getHash("SHA-256","HEX")},S=function(e){var t="";return e.isHidden&&(t+=" (",e.isHidden&&(t+="h"),t+=")"),t},j=function(e){e.ltiSessionId&&e.ltiUserId&&e.ltiNonce?(c().ltiData=e,c().hasLtiData=!0):c().hasLtiData=!1},$=function(e){var t=[];for(var r in e){var o=[{filename:e[r].filename,path:e[r].path,content:e[r].content,uniqueId:e[r].uniqueId,parentUId:e[r].parentUId,isFolder:e[r].isFolder,id:e[r].id,isHidden:e[r].isHidden}];t=e[r].children?t.concat($(e[r].children),o):t.concat(o)}return t};return{getProject:c,addFile:function(e,t){return m(e,t,!1)},addFolder:function(e,t){return m(e,t,!0)},renameNode:function(e,t){var o=function(e,t){if(e.path=t,e.children)for(var r=0;r<e.children.length;r++)o(e.children[r],e.path+"/"+e.filename)},r=c().idToNodeMap[e];r&&(r.filename=t,r.filename_annotated=t+S(r),r.isFolder&&o(r,r.path),h="")},removeNode:function(e,t){if(void 0!==c().idToNodeMap[e]&&0!==c().idToNodeMap[e].uniqueId&&(!c().idToNodeMap[e].isFolder||0===c().idToNodeMap[e].children.length||!0===t)){var r=c().idToNodeMap[e],o=c().idToNodeMap[r.parentUId],n=o.children.indexOf(r);o.children.splice(n,1),delete c().idToNodeMap[e],h=""}},getNode:i,hasNode:function(e){return!!c().idToNodeMap[e]},setNodeHidden:function(e){e.isHidden=!e.isHidden,e.filename_annotated=e.filename+S(e)},setProjectFromJSONdata:function(e,t,r){var o={},n=[];h="","[object Object]"===Object.prototype.toString.call(t)?o=t:"[object Array]"===Object.prototype.toString.call(t)&&(n=t),"[object Array]"===Object.prototype.toString.call(r)&&(n=r),function(e){f=e}({name:e.projectname,lastUId:e.lastUId,files:[],idToNodeMap:[],language:e.language,ltiData:{},userRole:e.userRole,userBeingInspected:e.username?e.username:null,staticFiles:n}),j(o);var s=e.fileSet;s.sort(function(e,t){return e.parentUId<t.parentUId?-1:e.parentUId>t.parentUId?1:0});var a=d(s[0].filename,s[0].path,s[0].uniqueId,s[0].parentUId,{content:s[0].content,isFolder:s[0].isFolder,id:s[0].id,isHidden:s[0].isHidden});c().files.push(a),c().idToNodeMap[c().files[0].uniqueId]=c().files[0];for(var i=1;i<s.length;i++)p(s[i].parentUId,s[i]);u()},saveProjectToServer:function(){var e={project:{lastUId:c().lastUId},files:$(c().files)};c().hasLtiData&&(e.hasLtiData=c().hasLtiData,e.ltiData=c().ltiData);var t=n.defer();return s.update({projectId:o.projectId},e,function(){u(),t.resolve(!0)},function(){t.reject(!1)}),t.promise},compileProject:function(e){var t=g(e),r=n.defer();return s.save({projectId:o.projectId},t,function(e){h=e.id,r.resolve(e)},function(e){h="";var t="\n-- Error details --";e.status&&e.data&&e.data.msg?(t+="\nStatus code: "+e.status,t+="\nError message: "+e.data.msg):t+="\n"+JSON.stringify(e),r.reject(t)}),r.promise},runProject:function(){var e={};e.language=c().language,e.action="run",e.id=h,e.hasLtiData=c().hasLtiData,e.ltiData=c().ltiData;var r=n.defer();return s.save({projectId:o.projectId},e,function(e){r.resolve(e)},function(e){h="";var t="\n-- Error details --";e.status&&e.data&&e.data.msg?(t+="\nStatus code: "+e.status,t+="\nError message: "+e.data.msg):t+="\n"+JSON.stringify(e),r.reject(t)}),r.promise},testProject:function(){var e=g(!0);e.action="test",e.id=h;var r=n.defer();return s.save({projectId:o.projectId},e,function(e){h=e.id,r.resolve(e)},function(e){h="";var t="\n-- Error details --";t+="\nStatus text: ",t+=e.statusText?e.statusText:"not available",t+="\nStatus code: ",t+=e.status?e.status:"not available",t+="\nError no: ",t+=e.data&&e.data.cause&&e.data.cause.errno?e.data.cause.errno:"not available",t+="\nError output: ",t+=e.data&&e.data.output?e.data.output:"not available",r.reject(t)}),r.promise},toolAction:function(){var e=g(!0);e.action="tool";var r=n.defer();return s.save({projectId:o.projectId},e,function(e){r.resolve(e)},function(e){h="";var t="\n-- Error details --";t+="\n\nStatusCode: ",t+=e.status?e.status:"no status code available",t+="\nMsg: ",t+=e.data.msg?e.data.msg:"no error details available",r.reject(t)}),r.promise},submitProject:function(){var e=g(!1);e.filesInDefaultFormat=$(c().files),e.userRole=c().userRole;var t=n.defer();return r.save({projectId:o.projectId},e,function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},isProjectModified:function(){return v()!==b},getNodeArray:$,getNewNode:d}}]),angular.module("codeboardApp").controller("UserSettingsCtrl",["$scope","$upload","$routeParams","$http","$timeout","$log","UserResSettings","userData",function(n,r,o,e,s,t,a,i){n.data=i,n.server={saveSuccess:!1,saveFailure:!1},n.save=function(e){var t={email:e.email,emailPublic:e.emailPublic,name:e.name,url:e.url,institution:e.institution,location:e.location};a.update({username:o.username},t).$promise.then(function(e){n.server.saveSuccess=!0,s(function(){n.server.saveSuccess=!1},4e3)})},n.onFileSelect=function(e){for(var t=0;t<e.length;t++){e[t];n.upload=r.upload({url:"/api/users/"+o.username+"/settings/userImage",data:{myObj:n.myModelObj},file:e}).progress(function(e){console.log("percent: "+parseInt(100*e.loaded/e.total))}).success(function(e,t,r,o){console.log(e),n.data.imageUrl=e.imageUrl})}}}]),angular.module("codeboardApp").controller("UserSettingsPasswordCtrl",["$scope","$routeParams","$http","$timeout","$log",function(n,r,o,s,a){n.passwordSubmitted=!1,n.invalidCurrentPassword=!1,n.pserver={saveSuccess:!1,saveFailure:!1},n.updatePassword=function(e){if(n.pserver.saveSuccess=!1,n.pserver.saveFailure=!1,n.invalidCurrentPassword=!1,n.passwordSubmitted=!0,n.changePasswordForm.$valid&&e.newPassword===e.newPasswordConfirm){var t={currentPassword:e.currentPassword,newPassword:e.newPassword};o.put("/api/users/"+r.username+"/settings/password",t).success(function(e,t,r,o){n.pserver.saveSuccess=!0,n.formModel={},n.passwordSubmitted=!1,s(function(){n.pserver.saveSuccess=!1},8e3)}).error(function(e,t,r,o){a.debug(t+" error:"+e.msg),n.pserver.saveFailure=!0,403===t&&(n.invalidCurrentPassword=!0)})}}}]);var uploadService=angular.module("uploadService",["ngResource","angularFileUpload"]),MyCtrl=["$scope","$upload",function(n,s){n.onSendFiles=function(e){for(var t=0;t<e.length;t++){var r=e[t],o={url:"/uploadProfilePicture/"+n.userId,data:{user:n.userId},file:r};n.upload=s.upload(o).progress(function(e){}).success(function(e,t,r,o){alert(e.reply)})}}}];angular.module("codeboardApp").service("IdeMsgService",function(){this.msgDisplayFileRequest=function(e){return{msg:"ide.displayFileRequest",data:{nodeId:e}}},this.msgNewNodeRequest=function(e){return{msg:"ide.newNodeRequest",data:{nodeType:e}}},this.msgNewNodeNameAvailable=function(e,t){return{msg:"ide.newNodeNameAvailable",data:{nodeName:e,nodeType:t}}},this.msgRenameNodeRequest=function(){return{msg:"ide.renameNodeRequest"}},this.msgDisplayRenameNodeModalRequest=function(e,t,r){return{msg:"ide.displayRenameNodeModalRequest",data:{nodeId:e,nodeName:t,nodeType:r}}},this.msgRenameNodeNameAvailable=function(e,t){return{msg:"ide.renameNodeNameAvailable",data:{nodeId:e,nodeName:t}}},this.msgRemoveNodeRequest=function(){return{msg:"ide.removeNodeRequest"}},this.msgRemoveNodeConfirmation=function(e){return{msg:"ide.removeNodeConfirmation",data:{uniqueId:e}}},this.msgSaveProjectRequest=function(){return{msg:"ide.saveProjectRequest"}},this.msgHideNodeRequest=function(){return{msg:"ide.hideNodeRequest"}},this.msgCompileRequest=function(){return{msg:"ide.compileRequest"}},this.msgCompileCleanRequest=function(){return{msg:"ide.compileCleanRequest"}},this.msgRunRequest=function(){return{msg:"ide.runRequest"}},this.msgStopRequest=function(){return{msg:"ide.stopRequest"}},this.msgStoppableActionAvailable=function(){return{msg:"ide.stoppableActionAvailable"}},this.msgStoppableActionGone=function(){return{msg:"ide.stoppableActionGone"}},this.msgTestRequest=function(){return{msg:"ide.testRequest"}},this.msgToolRequest=function(){return{msg:"ide.toolRequest"}},this.msgSubmitRequest=function(){return{msg:"ide.SubmitRequest"}},this.msgDisplayEditorRequest=function(e){return{msg:"ide.displayEditorRequest",data:{displayEditor:e}}},this.msgShowOutputAsText=function(){return{msg:"ide.showOutputAsText"}},this.msgReloadTreeFromProjectFactory=function(){return{msg:"ide.reloadTreeFromProjectFactory"}},this.msgShowEditorSettingsRequest=function(e){return{msg:"ide.showEditorSettingsRequest",data:{settings:e}}},this.msgEditorSettingsChanged=function(e){return{msg:"ide.editorSettingsChanged",data:{settings:e}}},this.msgEditorResizeRequest=function(){return{msg:"ide.editorResizeRequest"}},this.msgProcessViewQueryStringRequest=function(){return{msg:"ide.processViewQueryStringRequest"}},this.msgShowShareProjectModalRequest=function(){return{msg:"ide.showShareProjectModalRequest"}}}),angular.module("codeboardApp").service("IdeSnippetsSrv",function(){this.getEiffelSnippet=function(){return[{content:"feature {${1:CLASS}} -- ${2:comment}",name:"feature modifier",tabTrigger:"feature"},{content:'note\n\tdescription : "Description of the class"\n\tauthor      : "Name of author"\n\nclass\n\t${1:CLASS_NAME}\n\ninherit\n\t${2:CLASS_INHERIT}\n\nfeature {${3:CLASS_FEATURE}} -- ${4: feature comment}\n\n\t${5:--Add your routines here}\n\nend',name:"class",tabTrigger:"class"},{content:"${1:name}: ${2:type} = ${3}",name:"const",tabTrigger:"const"},{content:"inspect\n\t${1:exp}\nwhen ${2:value} then\n\t${3:-- code 1 here}\nelse\n\t${4:-- code 2 here}\nend",name:"inspect",tabTrigger:"inspect"},{content:"when ${2:value} then\n\t${3:-- code here}",name:"when",tabTrigger:"when"},{content:"from\n\t${1}\nuntil\n\t${2}\nloop\n\t${3}\nend",name:"from loop",tabTrigger:"from_loop"},{content:"across ${1:my_list} as ${2:ic} loop ${3:print(ic.item)} end",name:"across loop",tabTrigger:"across_loop"},{content:"if ${1:exp} then\n\t${2:-- code here }\nend",name:"if",tabTrigger:"if"},{content:"if ${1:exp} then\n\t${2:-- code}\nelse\n\t${3:-- code here}\nend",name:"ifelse",tabTrigger:"ifelse"},{content:"${1:routine_name} (${2:i: INTEGER})\n\t\t${3:-- feature comment}\n\trequire\n\t\t${4:-- preconditions}\n\tdo\n\t\t${5:-- code here}\n\tensure\n\t\t${6:-- postconditions}\n\tend",name:"routine",tabTrigger:"routine"},{content:"check\n\t${1:assertion}\nend ",name:"check",tabTrigger:"check"},{content:"create ${1:var}.make (${2:arguments}) ",name:"create",tabTrigger:"create"},{content:"local\n\t${1:var}: ${2:type}",name:"local",tabTrigger:"local"},{content:'print("${1:message}%N")',name:"Hint: print message",tabTrigger:"hint_print"},{content:"from\n\tmy_list.start\nuntil\n\tmy_list.off\nloop\n\tprint (my_list.item)\n\tmy_list.forth\nend",name:"Hint: from-loop over a list",tabTrigger:"hint_from_loop_over_a_list"},{content:"across my_list as ic loop print (ic.item) end",name:"Hint: across-loop over a list",tabTrigger:"hint_across_loop_over_a_list"}]}}),angular.module("codeboardApp").service("UserSrv",["$rootScope","SessionRes","$log","$location",function(t,e,r,o){var n=!1,s="";this.getUsername=function(){return s},this.isAuthenticated=function(){return n};this.signOutUser=function(){e.remove(function(){o.path("/")}),s="",n=!1},this.tryAuthenticateUser=function(){e.get(function(e){!function(e){s=e,n=!0}(e.username),t.$broadcast("userLoggedIn")},function(e){r.debug("Cannot authenticate user; Status: "+e.status)})}}]),angular.module("codeboardApp").factory("WebsocketSrv",["$websocket","$log",function(n,s){var a=null;return{connect:function(e,t,r,o){(a=n(e)).onOpen(function(){t()}),a.onMessage(function(e){var t=new FileReader;t.addEventListener("loadend",function(){r(t.result)}),t.readAsText(e.data)}),a.onClose(function(){s.debug("websocketSrvjs.onClose: the websocket connection was closed!"),o()}),a.onError(function(){s.debug("websocketSrvjs.onError: websocket error")})},close:function(e){var t=e||!1;a.close(t)},sendData:function(e){a&&1===a.readyState?(s.debug("WebsocketSrvjs.sendData: sending data "+e),a.send(e)):s.debug("WebsocketSrvjs.sendData: not sending data; WS not initialized or readyState not 1")}}}]),angular.module("codeboardApp").service("StatsSrv",function(){function g(e,t){var r=new Date(e.getTime());return r.setDate(r.getDate()+t),r}function f(e,t){return g(e,-t)}function h(e,t,r){for(var o=e;o<=t;){var n={_id:{year:o.getFullYear(),month:o.getMonth()+1,day:o.getDate()},count:0};r.push(n),o=g(o,1)}}return{sortAndAddMissingDates:function(e,t,r){function o(e,t){return new Date(e._id.year,e._id.month-1,e._id.day)-new Date(t._id.year,t._id.month-1,t._id.day)}r.sort(o);var n=r.length;if(0==n)h(e,t,r);else{var s=new Date(r[0]._id.year,r[0]._id.month-1,r[0]._id.day);if(864e5<=s-e){var a=f(s,1);h(e,a,r)}var i=new Date(r[n-1]._id.year,r[n-1]._id.month-1,r[n-1]._id.day);if(864e5<=t-i){var c=g(i,1);h(c,t,r)}}for(var u=0;u<n-1;u++){var d=new Date(r[u]._id.year,r[u]._id.month-1,r[u]._id.day),l=new Date(r[u+1]._id.year,r[u+1]._id.month-1,r[u+1]._id.day);if(864e5<=l-d){var p=g(d,1),m=f(l,1);h(p,m,r)}}r.sort(o)}}}),angular.module("codeboardApp").directive("ngEnter",function(){return function(t,e,r){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(r.ngEnter)}),e.preventDefault())})}}),angular.module("codeboardApp").directive("ngSelectOnFocus",["$timeout",function(o){return{restrict:"A",link:function(e,t,r){t.on("focus",function(){var e=this;o(function(){e.select()},10)})}}}]),angular.module("codeboardApp").factory("ProjectSettingsRes",["$resource",function(e){return e("/api/projects/:projectId/settings",{projectId:"@id"})}]).factory("ProjectSummaryRes",["$resource",function(e){return e("/api/projects/:projectId/summary",{projectId:"@id"})}]).factory("ProjectSubmissionRes",["$resource",function(e){return e("/api/projects/:projectId/submissions",{projectId:"@id"})}]).factory("ProjectRes",["$resource",function(e){return e("/api/projects/:projectId",{projectId:"@id"},{update:{method:"PUT"}})}]),angular.module("codeboardApp").factory("SessionRes",["$resource",function(e){return e("/api/session")}]),angular.module("codeboardApp").factory("UserRes",["$resource",function(e){return e("/api/users/:username",{username:"@username"})}]).factory("UserResSettings",["$resource",function(e){return e("/api/users/:username/settings",{username:"@username"},{update:{method:"PUT"}})}]).factory("UsersAllRes",["$resource",function(e){return e("/api/users/")}]),angular.module("codeboardApp").factory("UserProjectRes",["$resource",function(e){return e("/api/projects/:projectId/userprojects/:userprojectId",{userprojectId:"@userprojectId",projectId:"@projectId"})}]);